<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
  crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css"
  integrity="sha512-yHknP1/AwR+yx26cB1y0cjvQUMvEa2PFzt1c9LlS4pRQ5NOTZFWbhBig+X9G9eYW/8m0/4OXNx8pxJ6z57x0dw=="
  crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css"
  integrity="sha512-17EgCFERpgZKcm0j0fEq1YCJuyAWdz9KUtv1EjVuaOz8pDnh/0nZxmU6BBXwaaxqoi9PQXnRWqlcDB027hgv9A=="
  crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="/css/common.css">
  <link rel="stylesheet" href="/css/index.css">
  <link rel="icon" href="/image/favicon.png">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script th:inline="javascript">
  	const product = /*[[${product}]]*/
  		
  	/* 수량 추가 버튼 */
  	function plusCnt() {
  		const $pno = product.pno;
  		let $count = $('#p_num1').val();
  		let $price = $('#price').text();
  		$count++;
  		const params =  "pno=" + $pno + "&count=" + $count;
  		$.ajax("/product/productList/checkstock?" + params).done(() => {
  			$(this).prev().val($count);
  			$('#totalCnt').text($count);
  			$('#totalPrice').text($price * $count);
  		}).fail(() => alert("더 이상 구입할 수 없습니다."));
  	}
  	
  	/* 수량 감소 버튼 */
  	function minusCnt() {
  		const $pno = product.pno;
  		let $count = $('#p_num1').val();
  		let $price = $('#price').text();
  		if ($count > 1) {
  			$count--;
  			$(this).next().val($count);
  			$('#totalCnt').text($count);
  			$('#totalPrice').text($price * $count);
  		}
  	}
  	
  	/* 바로 구매 버튼 */
  	function toOrder() {
		const $form = $('<form>').attr('method', 'post').attr('action', '/order/preview/one').appendTo($('body'));
		$('<input>').attr('type', 'hidden').attr('name','pno').val(product.pno).appendTo($form);
		$('<input>').attr('type', 'hidden').attr('name','count').val($('#p_num1').val()).appendTo($form);
		$form.submit();
  	}
  	
  	/* 장바구니 버튼 */
  	function toCart() {
  		const check = confirm("상품이 담겼습니다. 장바구니로 이동하시겠습니까?");
  		if (check == true) {
  			const $form = $('<form>').attr('method', 'post').attr('action', '/order/cart/add').appendTo($('body'));
  			$('<input>').attr('type', 'hidden').attr('name','pno').val(product.pno).appendTo($form);
  			$('<input>').attr('type', 'hidden').attr('name','count').val($('#p_num1').val()).appendTo($form);
  			$form.submit();
  		} else {
  			$('<iframe>').attr('id', 'iframe1').attr('name', 'iframe1').attr('style', 'display:none').appendTo($('body'));  /* 화면 이동 없게 함 */
  			const $form = $('<form>').attr('method', 'post').attr('action', '/order/cart/add').attr('target', 'iframe1').appendTo($('body'));
  			$('<input>').attr('type', 'hidden').attr('name','pno').val(product.pno).appendTo($form);
  			$('<input>').attr('type', 'hidden').attr('name','count').val($('#p_num1').val()).appendTo($form);
  			$form.submit();
  		}
  	}
  	
	/* 페이지 정보 */
  	const cri = {
		pno : product.pno,
		nowPage : 1,
		amount : 10
	}
	
  	/* 후기 출력 (페이징) */
  	function makeHugi(obj) {
		console.log(obj.list);
  		if (obj.list.length === 0) {
            $(".hugizero").html('<span>후기가 없습니다. (≡^∇^≡)</span>');
            $(".hugilist").html('');
  		  	$(".hugiPageMaker").html('');
          } else {
            const list = obj.list;
            const pf = obj.pageInfo;
            $(list).each(function(i, obj) {
              const $tbody = $('#hugi_tbody');
              const $tr = $('<tr>').appendTo($tbody);
              $('<td>').text(obj.hno).appendTo($tr);
              $('<td>').text(obj.htitle).attr('class', 'title').data('num', obj.hno).appendTo($tr);
              $('<td>').text(obj.hwriter).appendTo($tr);
              $('<td>').text(obj.hregday).appendTo($tr);
              let $show = $('<tr>').attr('class', 'show').attr('style', 'display: none').appendTo($tr);
              if (obj.himg != null) {
                let $td = $('<td>').attr('colspan', '2').appendTo($show);
                $('<img>').attr('src', obj.himg).appendTo($td)
                $('<td>').attr('colspan', '2').text(obj.hcontent).appendTo($show);
              } else {
                $('<td>').attr('colspan', '4').text(obj.hcontent).appendTo($show);
              }
            });
              
            let reply_pageMaker = '';	
            
            /* prev */
  	  		if (pf.prev) {
  	  			let prev_num = pf.start -1;
  	  			reply_pageMaker += '<li class="hugiPageMaker_btn prev">';
  	  			reply_pageMaker += '<a href="'+ prev_num +'">이전</a>';
  	  			reply_pageMaker += '</li>';	
  	  		}
  	  		/* number btn */
  	  		for(let i = pf.start; i < pf.end+1; i++){
  	  			reply_pageMaker += '<li class="hugiPageMaker_btn ';
  	  			if(pf.cri.pageNum === i){
  	  				reply_pageMaker += 'active';
  	  			}
  	  			reply_pageMaker += '">';
  	  			reply_pageMaker += '<a href="' + i + '">' + i + '</a>';
  	  			reply_pageMaker += '</li>';
  	  		}
  	  		/* next */
  	  		if(pf.next){
  	  			let next_num = pf.end +1;
  	  			reply_pageMaker += '<li class="hugiPageMaker_btn next">';
  	  			reply_pageMaker += '<a href="'+ next_num +'">다음</a>';
  	  			reply_pageMaker += '</li>';	
  	  		}
  	  		
  	  		$(".hugiPageMaker").html(reply_pageMaker);	
          };
  	}
  	
	/* 후기 데이터 요청 */
	function requestHugi() {
  		$.getJSON("/productDetail/hugilist?", cri, function(obj) {
      	  makeHugi(obj);
        });
	}
	
	/* 후기 페이징 버튼 */
  	$(document).on('click', '.hugiPageMaker_btn a', function(e){
  		e.preventDefault();
  		let page = $(this).attr("href");
  		cri.nowPage = page;
  		$('#hugi_tbody').empty();
  		requestHugi();
	});
  	
  	/* 문의 출력 (페이징) */
  	function makeQna(obj) {
  		if (obj.list.length === 0) {
            $(".qnazero").html('<span>문의가 없습니다. (≡^∇^≡)</span>');
            $(".qnalist").html('');
  		  	$(".qnaPageMaker").html('');
          } else {
            const list = obj.list;
            const pf = obj.pageInfo;
            $(list).each(function(i, obj) {
              const $tbody = $('#qna_tbody');
              const $tr = $('<tr>').appendTo($tbody);
              $('<td>').text(obj.qqno).appendTo($tr);
              $('<td>').text(obj.qqcategory).appendTo($tr);
              $('<td>').text(obj.qqtitle).attr('class', 'title').data('num', obj.qqno).appendTo($tr);
              $('<td>').text(obj.memberId).appendTo($tr);
              $('<td>').text(obj.qqregday).appendTo($tr);
              let $show = $('<tr>').attr('class', 'show').attr('style', 'display: none').appendTo($tr);
              if (obj.qqimg != null) {
                let $td = $('<td>').attr('colspan', '2').appendTo($show);
                $('<img>').attr('src', obj.qqimg).appendTo($td)
                $('<td>').attr('colspan', '3').text(obj.qqcontent).appendTo($show);
              } else {
                $('<td>').attr('colspan', '5').text(obj.qqcontent).appendTo($show);
              }
            });
              
            let reply_pageMaker = '';	
              /* prev */
  	  		if (pf.prev) {
  	  			let prev_num = pf.start -1;
  	  			reply_pageMaker += '<li class="qnaPageMaker_btn prev">';
  	  			reply_pageMaker += '<a href="'+ prev_num +'">이전</a>';
  	  			reply_pageMaker += '</li>';	
  	  		}
  	  		/* number btn */
  	  		for(let i = pf.start; i < pf.end+1; i++){
  	  			reply_pageMaker += '<li class="qnaPageMaker_btn ';
  	  			if(pf.cri.pageNum === i){
  	  				reply_pageMaker += 'active';
  	  			}
  	  			reply_pageMaker += '">';
  	  			reply_pageMaker += '<a href="' + i + '">' + i + '</a>';
  	  			reply_pageMaker += '</li>';
  	  		}
  	  		/* next */
  	  		if(pf.next){
  	  			let next_num = pf.end +1;
  	  			reply_pageMaker += '<li class="qnaPageMaker_btn next">';
  	  			reply_pageMaker += '<a href="'+ next_num +'">다음</a>';
  	  			reply_pageMaker += '</li>';	
  	  		}
  	  		
  	  		$(".qnaPageMaker").html(reply_pageMaker);	
          };
  	}
	
	/* 문의 데이터 요청 */
	function requestQna() {
  		$.getJSON("/productDetail/qnalist?", cri, function(obj) {
      	  makeQna(obj);
        });
	}
	
	/* 문의 페이징 버튼 */
  	$(document).on('click', '.qnaPageMaker_btn a', function(e){
  		e.preventDefault();
  		let page = $(this).attr("href");
  		cri.nowPage = page;
  		$('#qna_tbody').empty();
  		requestQna();
	});
	
  	$(document).ready(function() {
      // reviewList();
  	  // qnaQList();
  	  $('#plus').click(plusCnt);
  	  $('#minus').click(minusCnt);
  	  $('#order').click(toOrder);
  	  $('#cart').click(toCart);
 		
      const pno = product.pno;
      
      /* 문의 출력 */
      $.getJSON("/productDetail/qnalist?", {pno : pno}, function(obj) {
    	  makeQna(obj);
      });
      
      /* 후기 출력 */
      $.getJSON("/productDetail/hugilist?", {pno : pno}, function(obj) {
    	  makeHugi(obj);
      });
	});
  </script>
  <title>상품 상세페이지</title>
  <style>
    h3 {
      text-align: center;
      margin-top: 20px;
    }
    .productinfo {
      width: 900px;
      height: 350px;
      margin: 0 auto;
      
    }
    .product-img {
      float: left;
      margin: 10px;
    }
* {box-sizing: border-box}
body {font-family: Verdana, sans-serif; margin:0}
.mySlides {display: none}
img {vertical-align: middle; height: 300px;}

/* Slideshow container */
.slideshow-container {
  width: 350px;
  position: relative;
  margin: auto;
}

/* Next & previous buttons */
.prev, .next {
  cursor: pointer;
  position: absolute;
  top: 50%;
  width: auto;
  padding: 16px;
  margin-top: -22px;
  color: white;
  font-weight: bold;
  font-size: 18px;
  transition: 0.6s ease;
  border-radius: 0 3px 3px 0;
  user-select: none;
}

/* Position the "next button" to the right */
.next {
  right: 0;
  border-radius: 3px 0 0 3px;
}

/* On hover, add a black background color with a little bit see-through */
.prev:hover, .next:hover {
  background-color: rgba(0,0,0,0.8);
}

/* The dots/bullets/indicators */
.dot {
  cursor: pointer;
  height: 15px;
  width: 15px;
  margin: 0 2px;
  background-color: #bbb;
  border-radius: 50%;
  display: inline-block;
  transition: background-color 0.6s ease;
}

.active, .dot:hover {
  background-color: #717171;
}

/* Fading animation */
.fade {
  animation-name: fade;
  animation-duration: 1.5s;
}

@keyframes fade {
  from {opacity: .4} 
  to {opacity: 1}
}

/* On smaller screens, decrease text size */
@media only screen and (max-width: 300px) {
  .prev, .next,.text {font-size: 11px}
}
.product-info {
  float: right;
  height: 350px;
  width: 500px;
  /* padding: 10px; */
  margin: 10px;
  text-align: start;
}
.inside-product {
  width: 900px;
  display: flex;
  justify-content: space-around;
  margin-bottom: 20px;
}
.reviewlist {
  width: 900px;
  text-align: center;
}
.qnalist {
  width: 900px;
  text-align: center;
}

</style>
</head>
<body>
  <header>
    <div class="logo"><a href="index.html">ECorea</a></div>
  </header>
  <h3>상품 상세페이지</h3><br>
  <nav>
    <div class="topnav">
      <a href="#">생활</a>
      <a href="#">제로웨이스트</a>
      <a href="#">소품</a>
      <a href="#">DIY</a>
      <div class="topnav-right">
        <a href="#">챌린지</a>
        <a href="#">브랜드 소개</a>
      </div>
    </div>
  </nav>

  <div class="productinfo">
    <div class="product-img">
      <div class="slideshow-container">

        <div class="mySlides fade">
          <img th:src="${product.pthumbnail}" alt="상품" style="width:100%">
        </div>
        
        <div class="mySlides fade">
          <img src="../../image/product.jpg" alt="상품" style="width:100%">
        </div>
        
        <div class="mySlides fade">
          <img src="../../image/product.jpg" alt="상품" style="width:100%">
        </div>
        
        <a class="prev" onclick="plusSlides(-1)">❮</a>
        <a class="next" onclick="plusSlides(1)">❯</a>
        
        </div>
        <br>
        
        <div style="text-align:center">
          <span class="dot" onclick="currentSlide(1)"></span> 
          <span class="dot" onclick="currentSlide(2)"></span> 
          <span class="dot" onclick="currentSlide(3)"></span> 
        </div>
    </div>
    <div class="product-info">
      <p style="font-size:20px;" th:text="${product.pname}">상품명</p><br>
      <span>판매가격 : <span id="price" th:text="${product.price}"></span> 원</span><br>
      <!--
      <p style="font-size:20px;">상품명</p><br>
      <span>판매가격 : <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;원</span></span><br>
       -->
      <div class="updown">
        <span>수량 : </span>&nbsp;&nbsp;&nbsp;<button type="button" id="minus">-</button>
        <input type="text" name="p_num1" id="p_num1" size="2" maxlength="4" class="p_num" value="1">
        <button type="button" id="plus">+</button>
      </div>
      <span>옵션 : </span><select class="form-select form-select-sm" style="width: 200px;">
        <option selected disabled>옵션을 선택하세요</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
      </select><br>
      <span>총 합계 : </span><span><span id='totalPrice' th:text="${product.price}"></span>&nbsp;원</span><span> (<span id='totalCnt'>1</span>&nbsp;개)</span><br><br>
      <button type="button" class="btn btn-primary" id="order" value="바로구매">바로구매</button>
      <button type="button" class="btn btn-primary" id="cart" value="장바구니 담기">장바구니 담기</button>
      <button type="button" class="btn btn-primary" value="관심상품 등록" formaction="#">관심상품 등록</button>
    </div>
      <div class="inside-product topnav topnav-right">
      <a href="#content1">상품 상세정보</a>
      <a href="#content2">구매 후기</a>
      <a href="#content3">상품 문의</a>
    </div>
    <div class="detail-product" id="content1">
    <p th:text='${product.pcontent}'></p>
  </div>
  <hr>
  <h3 style="text-align: center;" id="content2">구매 후기</h3>
  <div class="hugizero">
  </div>
  <div class="hugilist">
    <table class="table">
      <thead class="thead-light">
        <tr>
          <th>번호</th>
          <th>제목</th>
          <th>작성자</th>
          <th>등록일</th>
        </tr>
      </thead>
      <tbody id="hugi_tbody">
      <!-- 
      	<tr>
	       	  <td th:text="${hugi.hno}">
	       	  <td th:text="${hugi.htitle}" class="title">
	       	  <td th:text="${hugi.hwriter}">
	       	  <td th:text="${hugi.hregday}">
	       	  <tr class="show" style="display: none">
  				 <div th:if="${not #strings.isEmpty(hugi.himg)}">
			     	 <td colspan="2"> <img th:src="${hugi.himg}"></td>
		             <td colspan="3" th:text="${hugi.hcontent}"></td>
				 </div>
				 <div th:unless="${not #strings.isEmpty(hugi.himg)}">
		             <td colspan="5" th:text="${hugi.hcontent}"></td>
				 </div>
	             <td colspan="4" th:text="${hugi.hcontent}">본문</td>
	          </tr>
         </tr>
         -->
       </tbody>
    </table>
  </div>
  <div class="hugiPageMaker">
  </div>
  <hr>
  <h3 style="text-align: center;" id="content3">상품 문의</h3>
  <div class="qnazero">
  </div>
  <div class="qnalist">
      <table class="table">
        <thead class="thead-light">
          <tr>
            <th>번호</th>
            <th>카테고리</th>
            <th>제목</th>
            <th>작성자</th>
            <th>등록일</th>
          </tr>
        </thead>
        <tbody id="qna_tbody">
          <!--
          <tr>
            <td th:text="${qqna.qqno}">
            <td th:text="${qqna.qqcategory}">
            <td th:text="${qqna.qqtitle}" class="title">
            <td th:text="${qqna.memberId}">
            <td th:text="${qqna.qqregday}">
            <tr class="show" style="display: none">
              <div th:if="${not #strings.isEmpty(qqna.qqimg)}">
                <td colspan="2"> <img th:src="${qqna.qqimg}"></td>
                <td colspan="3" th:text="${qqna.qqcontent}"></td>
              </div>
              <div th:unless="${not #strings.isEmpty(qqna.qqimg)}">
                <td colspan="5" th:text="${qqna.qqcontent}"></td>
              </div>
            </tr>
          </tr>
          -->
        </tbody>
      </table>
    </div>
    <div class="qnaPageMaker">
    </div>
  </div>

  <script>
  	/* 제목 클릭 시 본문 출력 */
	$(document).on('click', '.title', function() {
		console.log($(this).next().next().next().attr('style'));
		if ($(this).next().next().next().attr('style') == 'display: none') {
			$(this).next().next().next().attr('style', 'display: ');
		} else {
			$(this).next().next().next().attr('style', 'display: none');
		}
	})
  
	  /* 제목 눌렀을 때 본문 출력      
	  let show = document.getElementsByClassName('show');
	  let title = document.getElementsByClassName('title');
	  
	  for (let i=0; i<title.length; i++) {
	    title[i].addEventListener('click', function(){
	       if(show[i].style.display==='none') {
	          show[i].style.display="";
	       } else {
	          show[i].style.display='none';
	       }
	    });
	  }
	  */
  
    let slideIndex = 1;
    showSlides(slideIndex);
    
    function plusSlides(n) {
      showSlides(slideIndex += n);
    }
    
    function currentSlide(n) {
      showSlides(slideIndex = n);
    }
    
    function showSlides(n) {
      let i;
      let slides = document.getElementsByClassName("mySlides");
      let dots = document.getElementsByClassName("dot");
      if (n > slides.length) {slideIndex = 1}    
      if (n < 1) {slideIndex = slides.length}
      for (i = 0; i < slides.length; i++) {
        slides[i].style.display = "none";  
      }
      for (i = 0; i < dots.length; i++) {
        dots[i].className = dots[i].className.replace(" active", "");
      }
      slides[slideIndex-1].style.display = "block";  
      dots[slideIndex-1].className += " active";
    }
    </script>
</body>
</html>