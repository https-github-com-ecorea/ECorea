<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/common.css">
  <style>
    #comment {
      width: 400px;
    }
    .wrapper {
      position:absolute;
      left: 30%;
    }
  </style>
  <script>
	/* 배송지 목록 */
	function addressList() {
		$.ajax("/mypage/member/addressListRest").done(result => {
			$.each(result, function(idx, address) {
				$radio = $("<input type='radio' name='address' class='address'>").attr("data-ano", address.ano).appendTo($('#radio_btn_area'));
				$("<span>").text(address.aname).appendTo($("#radio_btn_area"));
				if (address.astandard == 1) { /* 기존 배송지 우선 선택 */
					$radio.prop("checked", true);
					$('#chosen_address_info').text("(" + address.azipcode + ") " + address.aaddress1 + " " + address.aaddress2);
				}
			})
		})
	}

	$(document).ready(function() {
		/* 배송지 목록 출력 */
		addressList();

		/* 배송지 추가 팝업창 */
		$('#add_address_btn').click(function() {
			const popup = window.open('/mypage/member/newAddress', '_blank', 'toolbar=yes, menubar=yes, width=700, height=700');
			$(popup).on("beforeunload", $('#radio_btn_area').empty(), addressList); /* 닫기 전에 버튼 블록 비우고 새 데이터 재출력 */
		})

		/* 선택한 배송지 출력 */
		$('#radio_btn_area').on("click", ".address", function() {
			const $ano = $(this).attr("data-ano");
			$.ajax("/mypage/member/chosenAddress/" + $ano).done(address => {
				$('#chosen_address_info').text("(" + address.azipcode + ") " + address.aaddress1 + " " + address.aaddress2)
			})
		})
	})
  </script>
  <title>배송 주소록 관리</title>
</head>
<body>
  <h1>배송 주소록 관리</h1>
  <div class="wrapper">
  <button type="submit" class="btn btn-primary" style="margin-bottom: 30px;">배송지 추가</button><br>
  <div class="form-check form-check-inline">
    <input type="radio" class="form-check-input" id="radio1" name="optradio" value="option1" checked>배송지명1
    <label class="form-check-label" for="radio1"></label>
  </div>
  <div class="form-check form-check-inline">
    <input type="radio" class="form-check-input" id="radio2" name="optradio" value="option2">배송지명2
    <label class="form-check-label" for="radio2"></label>
  </div>
  <div class="form-check form-check-inline">
    <input type="radio" class="form-check-input" id="radio3" name="optradio" value="option3">배송지명3
    <label class="form-check-label" for="radio3"></label><br>
  </div>
  <textarea class="form-control" rows="3" id="comment" name="text" readonly style="background-color: white;"></textarea>
</div>
</body>
</html>