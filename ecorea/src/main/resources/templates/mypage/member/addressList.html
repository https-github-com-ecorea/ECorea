<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="/css/common.css">
  <style>
    body {
  background: url('/image/bg.png');
  }
    #comment {
      width: 400px;
    }
    .wrapper {
      position:absolute;
      left: 30%;
    }
  </style>
  <title>배송 주소록 관리</title>
  <script>
	/* 배송지 목록 */
	function addressList() {
		$.ajax("/mypage/member/addressListRest").done(result => {
			$.each(result, function(idx, address) {
				$radio = $("<input type='radio' name='address' class='address'>").attr("data-ano", address.ano).appendTo($('#radio_btn_area'));
				$("<span>").text(address.aname).appendTo($("#radio_btn_area"));
				if (address.astandard == 1) { /* 기존 배송지 우선 선택 */
					$radio.prop("checked", true);
					if (address.aaddress2 != null)
						$('#chosen_address_info').text("(" + address.azipcode + ") " + address.aaddress1 + ", " + address.aaddress2);
					else
						$('#chosen_address_info').text("(" + address.azipcode + ") " + address.aaddress1);
				}
			})
		})
	}

	$(document).ready(function() {
		/* 배송지 목록 출력 */
		addressList();
		
		/* 배송지 추가 팝업창 */
		$('#add_address_btn').click(function() {
			const popup = window.open('/mypage/member/newAddress', '_blank', 'toolbar=yes, menubar=yes, width=700, height=700');
			$(popup).on("beforeunload", $('#radio_btn_area').empty(), addressList); /* 닫기 전에 버튼 블록 비우고 새 데이터 재출력 */
		})

		/* 선택한 배송지 출력 */
		$('#radio_btn_area').on("click", ".address", function() {
			const $ano = $(this).attr("data-ano");
			$.ajax("/mypage/member/chosenAddress/" + $ano).done(address => {
				if (address.aaddress2 != null)
					$('#chosen_address_info').text("(" + address.azipcode + ") " + address.aaddress1 + ", " + address.aaddress2);
				else
					$('#chosen_address_info').text("(" + address.azipcode + ") " + address.aaddress1);
			})
		})
	})
  </script>
</head>
<body>
<script>
</script>
<div id="page">
	<div id="main">
		<div>
			<button id="add_address_btn">배송지 추가</button>
			<div id="radio_btn_area">
			<!-- 등록된 배송지들을 라디오 버튼으로 출력하는 영역 -->
			</div>
			<hr>
			<div id="address_info_area">
				<span>배송지 : </span>
				<!-- radio로 선택한 배송지 정보를 출력하는 영역 -->
				<span id="chosen_address_info"></span>
			</div>
			<hr>
		</div>
	</div>
</div>
</body>
</html>